<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta content="width=device-width, initial-scale=0.8" name="viewport">
      <title>Scavenger Hunt</title>
      <!-- Use url_for to link to static assets -->
      <link href="{{ url_for('static', filename='images/favicon.svg') }}" rel="icon">
      <link href="{{ url_for('static', filename='css/branding.css') }}" rel="stylesheet">
      <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,200&icon_names=celebration,social_leaderboard" rel="stylesheet"/>
      <style>
         /* Modal styles */
         .modal {
         display: none; 
         position: fixed; 
         z-index: 1; 
         left: 0;
         top: 0;
         width: 100%; 
         height: 100%; 
         overflow: auto; 
         background-color: rgb(0,0,0); 
         background-color: rgba(0,0,0,0.4); 
         }
         .modal-content {
         background-color: #fefefe;
         margin: 15% auto;
         padding: 20px;
         border: 1px solid #888;
         width: 80%;
         }
         .close {
         color: #aaa;
         float: right;
         font-size: 28px;
         font-weight: bold;
         }
         .close:hover,
         .close:focus {
         color: black;
         text-decoration: none;
         cursor: pointer;
         }
      </style>
   </head>
   <body>
      <div class="page-container" id="welcome" style="display:flex;">
         <img alt="ESN Logo" class="page-top-image" src="{{ url_for('static', filename='images/logo.svg') }}">
         <h1 class="title">Welcome Admin!</h1>
         <br>
         <button ID="openModalLink"> Generate QR codes </button>
		 <br>
		 <button type="button" id="download_files">Download All Files</button><br>
		<button id="openUploadModal">Upload Multiple Files</button>

      </div>
      <!-- Modal Structure -->
      <div id="qrModal" class="modal">
         <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Generate QR Codes PDF</h2>
            <form action="/generate_pdf" method="POST" enctype="multipart/form-data">
				<div id="existing_file_section">

                  <label for="use_existing">
                  <input type="checkbox" id="use_existing" name="use_existing" value="true">
                  Use the previously uploaded file
				  <a href="/static/game/locations.csv" id="existing_file_link" target="_blank">Download last_uploaded.csv</a>
                  </label>
				  
				</div>
			   
				<div id="upload_section">
				<br>
                  <label for="csv_file">OR Upload New CSV File:</label>
                  <input type="file" id="csv_file" name="csv_file"> 
				</div>
				
				 <br>
                  <br>
               
               <label for="base_url">Base URL:</label>
               <input type="text" id="base_url" name="base_url" value="polaris.esncy.org" required><br><br>
               <button type="submit">Generate QR Codes PDF</button>
            </form>
         </div>
      </div>
	  
	  <div id="uploadModal" class="modal">
   <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Upload and Replace Files</h2>
      <form id="upload_form" action="/upload_files" method="POST" enctype="multipart/form-data">
    <label for="multiple_files">Upload 4 Files:</label>
    <input type="file" id="multiple_files" name="multiple_files" multiple required><br><br>
    <button type="submit">Upload and Replace Files</button>
</form>

<div id="message"></div> <!-- To display the success or error message -->

   </div>
</div>


      <script>
         const useExistingCheckbox = document.getElementById('use_existing');
         const uploadSection = document.getElementById('upload_section');
         
         // Toggle the file upload section based on the checkbox state
         useExistingCheckbox.addEventListener('change', () => {
             if (useExistingCheckbox.checked) {
                 uploadSection.style.display = 'none'; // Hide file upload
                 document.getElementById('csv_file').removeAttribute('required'); // Make optional
             } else {
                 uploadSection.style.display = 'block'; // Show file upload
                 document.getElementById('csv_file').setAttribute('required', 'true'); // Make required
             }
         });
         
         // Check if a previously uploaded file exists
         // You can dynamically update the "existing_file_section" based on server data.
      </script>
      <script>
         // Get modal element
         var modal = document.getElementById("qrModal");
         
         // Get the link that opens the modal
         var openModalLink = document.getElementById("openModalLink");
         
         // Get the <span> element that closes the modal
         var closeModalSpan = document.getElementsByClassName("close")[0];
         
         // When the user clicks the link, open the modal
         openModalLink.onclick = function(event) {
             event.preventDefault();  // Prevent the default link behavior
             modal.style.display = "block";
         }
         
         // When the user clicks on <span> (x), close the modal
         closeModalSpan.onclick = function() {
             modal.style.display = "none";
         }
         
         // When the user clicks anywhere outside the modal, close it
         window.onclick = function(event) {
             if (event.target == modal) {
                 modal.style.display = "none";
             }
         }
      </script>
	  

	<script>
   // Get modal elements
   const uploadModal = document.getElementById("uploadModal");
   const openUploadModalButton = document.getElementById("openUploadModal");
   const closeUploadModalSpan = uploadModal.getElementsByClassName("close")[0];

   // Open the upload modal
   openUploadModalButton.onclick = function(event) {
       event.preventDefault(); // Prevent default behavior
	   document.getElementById('message').innerHTML = "";
	   uploadModal.style.display = "block";
   };

   // Close the upload modal
   closeUploadModalSpan.onclick = function() {
       uploadModal.style.display = "none";
   };

   // Close modal when clicking outside of it
   window.onclick = function(event) {
       if (event.target == uploadModal) {
           uploadModal.style.display = "none";
       }
   };
</script>

<script>
document.getElementById('upload_form').addEventListener('submit', function(event) {
    event.preventDefault();  // Prevent the default form submission

    var formData = new FormData(this);  // Create FormData object with the form data

    // Send the form data using AJAX (Fetch API)
    fetch('/upload_files', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())  // Expecting JSON response from server
    .then(data => {
        // Display success or error message based on the server's response
        document.getElementById('message').innerHTML = data.message;
    })
    .catch(error => {
        // Handle any error that occurred during the request
        document.getElementById('message').innerHTML = 'Error: ' + error.message;
    });
});
</script>



<script>
    const downloadFilesButton = document.getElementById('download_files');

    downloadFilesButton.addEventListener('click', () => {
        const files = [
            '/static/game/textHints.csv',
            '/static/game/textChallenges.csv',
            '/static/game/locations.csv',
            '/static/game/imageHints.csv'
        ];
        files.forEach(file => {
            const a = document.createElement('a');
            a.href = file;
            a.download = file.split('/').pop(); // Download the file with its name
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    });
</script>



      <footer id="footer" style="position: relative; bottom: 0;">
         Powered by Polaris
         <img alt="ESN Logo" class="polaris-logo" src="{{ url_for('static', filename='images/polarisLogo.svg') }}">
      </footer>
      <!-- Use url_for to link to JS file -->
   </body>
</html>